Parameters:
  PrivateSonarSubnet1:
    Description: Please enter the IP range (CIDR notation) for the public subnet in the first Availability Zone
    Type: String
    Default: 10.192.20.0/24
  
  PrivateSonarSubnet2:
    Description: Please enter the IP range (CIDR notation) for the public subnet in the first Availability Zone
    Type: String
    Default: 10.192.30.0/24

  PrivateSonarSubnet3:
    Description: Please enter the IP range (CIDR notation) for the public subnet in the first Availability Zone
    Type: String
    Default: 10.192.40.0/24

  EnvironmentName:
      Description: An environment name that is prefixed to resource names
      Type: String
      Default: SonarPrivate

  StackParameterName:
    Description: Name of stack to import
    Type: String
    Default: SonarVPC

Resources:
  PrivateSubnet1:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId: 
        Fn::ImportValue:
          'Fn::Sub': '${StackParameterName}-VPCID'
      AvailabilityZone: !Select [ 0, !GetAZs  '' ]
      CidrBlock: !Ref PrivateSonarSubnet1
      MapPublicIpOnLaunch: false
      Tags:
        - Key: Name
          Value: !Sub
            - "${EnvironmentName}1"
            - EnvironmentName: !Ref EnvironmentName


  PrivateSubnet2:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId: 
        Fn::ImportValue:
          'Fn::Sub': '${StackParameterName}-VPCID'
      AvailabilityZone: !Select [ 1, !GetAZs  '' ]
      CidrBlock: !Ref PrivateSonarSubnet2
      MapPublicIpOnLaunch: false
      Tags:
        - Key: Name
          Value: !Sub
            - "${EnvironmentName}2"
            - EnvironmentName: !Ref EnvironmentName


  PrivateSubnet3:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId: 
        Fn::ImportValue:
          'Fn::Sub': '${StackParameterName}-VPCID'
      AvailabilityZone: !Select [ 2, !GetAZs  '' ]
      CidrBlock: !Ref PrivateSonarSubnet3
      MapPublicIpOnLaunch: false
      Tags:
        - Key: Name
          Value: !Sub
            - "${EnvironmentName}3"
            - EnvironmentName: !Ref EnvironmentName


  PrivateRouteTable:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId: 
        Fn::ImportValue: 
          'Fn::Sub': '${StackParameterName}-VPCID'


Outputs:
  PrivateSubnetID1:
    Description: A reference to the created private subnet
    Value: !Ref PrivateSubnet1
    Export:
      Name: !Sub "${AWS::StackName}-PrivateSubnetID1"

  PrivateSubnetID2:
    Description: A reference to the created private subnet
    Value: !Ref PrivateSubnet2
    Export:
      Name: !Sub "${AWS::StackName}-PrivateSubnetID2"

  PrivateSubnetID3:
    Description: A reference to the created private subnet
    Value: !Ref PrivateSubnet3
    Export:
      Name: !Sub "${AWS::StackName}-PrivateSubnetID3"

  AZ1:
    Description: AZ of PrivateSubnet1
    Value: !GetAtt PrivateSubnet1.AvailabilityZone
    Export:
      Name: !Sub "${AWS::StackName}-AZ1" 

  AZ2:
    Description: AZ of PrivateSubnet2
    Value: !GetAtt PrivateSubnet2.AvailabilityZone
    Export:
      Name: !Sub "${AWS::StackName}-AZ2" 

  AZ3:
    Description: AZ of PrivateSubnet3
    Value: !GetAtt PrivateSubnet3.AvailabilityZone
    Export:
      Name: !Sub "${AWS::StackName}-AZ3" 

  PrivateRouteTable:
    Description: A reference to the created private subnet
    Value: !Ref PrivateRouteTable
    Export:
      Name: !Sub "${AWS::StackName}-PrivateRouteTable"

  PrivateSubnetIDCIDR1:
    Description: A reference to the created private subnet
    Value: !Ref PrivateSonarSubnet1
    Export:
      Name: !Sub "${AWS::StackName}-PrivateCIDR1"

  PrivateSubnetIDCIDR2:
    Description: A reference to the created private subnet
    Value: !Ref PrivateSonarSubnet2
    Export:
      Name: !Sub "${AWS::StackName}-PrivateCIDR2"

  PrivateSubnetIDCIDR3:
    Description: A reference to the created private subnet
    Value: !Ref PrivateSonarSubnet3
    Export:
      Name: !Sub "${AWS::StackName}-PrivateCIDR3"