Parameters:
  StackParameterName:
    Description: Name of stack to import
    Type: String
    Default: SonarVPC

  PrivateSubnetStackParameterName:
    Description: Name of stack to import
    Type: String
    Default: SonarPrivate

Resources:
  SonarSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: Allow http to client host
      VpcId:
        Fn::ImportValue:
          'Fn::Sub': '${StackParameterName}-VPCID'
      SecurityGroupIngress:
        - IpProtocol: tcp
          FromPort: 80
          ToPort: 80
          CidrIp: 0.0.0.0/0
      SecurityGroupEgress:
        - IpProtocol: tcp
          FromPort: 80
          ToPort: 80
          CidrIp: 0.0.0.0/0


  SonarSecurityGroupPrivate:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: Allow http to client host
      VpcId:
        Fn::ImportValue:
          'Fn::Sub': '${StackParameterName}-VPCID'
      SecurityGroupIngress:
        - IpProtocol: tcp
          FromPort: 80
          ToPort: 80
          CidrIp:
            Fn::ImportValue:
              'Fn::Sub': '${PrivateSubnetStackParameterName}-PrivateCIDR1'
      SecurityGroupEgress:
        - IpProtocol: tcp
          FromPort: 80
          ToPort: 80
          CidrIp: 0.0.0.0/0

Outputs:
    SonarSecurityGroup:
        Description: SecurityGroup for Sonar
        Value: !Ref SonarSecurityGroup
        Export:
            Name: !Sub "${AWS::StackName}-SG"

    SonarSecurityGroupPrivate:
        Description: SecurityGroup for Sonar
        Value: !Ref SonarSecurityGroupPrivate
        Export:
            Name: !Sub "${AWS::StackName}-PrivateSG"